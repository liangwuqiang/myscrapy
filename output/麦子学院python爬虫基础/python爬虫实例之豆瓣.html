<!DOCTYPE html>
        <html><head><meta charset="UTF-8">
        </head><body>
        <p><center><h1>python爬虫实例之豆瓣</h1></center></p>
            <div class="cont">
<h1>python爬虫实例之豆瓣</h1>
<p><p><br/></p><hr/><p><strong>热播电影数据格式</strong></p><p><br/></p><p>使用Chrome的开发者工具查看豆瓣热播电影的数据格式</p><p><br/></p><p><img alt="example1.png" src="images/4dd69640258c2f75bfca04b95098980a.png" title="5a6bOczBRRG9zux3Ol.png"/></p><p><br/></p><p><strong>示例：我们要爬下来的东西</strong></p><p><br/></p><p>打开Chrome的开发者工具</p><p><br/></p><p><img alt="example2.png" src="images/5dcf21a7f5271ea183be6b8284fd833f.png" title="DbUppIXpeY1gyCzu0J.png"/></p><p><br/></p><p>查看我们要爬的区域是用哪些http来展示的呢？我们选中这个正在上映的区域。</p><p><br/></p><p><img alt="example3.png" src="images/4eaca977601cf008e81778b3cdc97905.png" title="e3fpGkLFjq0D6wt3jG.png"/></p><p><br/></p><p>点击一下，它会自动进入</p><p><br/></p><p><img alt="example4.png" src="images/909722ae715c23d0b8237ba8ec964c8c.png" title="Be3SfMSWTWsdtl2PPw.png"/></p><p><br/></p><p>点击查看，我们可以看到，我们要查看的内容实际上是一个列表</p><p><br/></p><p><img alt="example5.png" src="images/5adc6fee69a5c6c00dacc5c09c6f0082.png" title="ukjFWNTV5QHun78YO2.png"/></p><p><br/></p><p>解析出url下面的所有的li，我们看一下第一个电影寻龙诀的数据，date_title是一个属性，属性里面是一个电影名称，里面还有一些评分，电影的时长，导演，演员，这样的我们就可以把这个正在热播的电影给它解析出来。</p><p><br/></p><p><img alt="example6.png" src="images/4e82a9a94514e2246659119e7f250f81.png" title="I4GzsKAxEL3ikix9wH.png"/></p><p><br/></p><hr/><h3><span style="color: rgb(94, 207, 186);">HTMLParser简介</span></h3><p><br/></p><p>主要用来解析HTTP数据，那它有几个常用的接口</p><p><br/></p><p>1）feed：向解析器喂数据，可以分段提供</p><p><br/></p><p>2）handler_starttag：处理html的开始标签</p><p><br/></p><p>a.tag：标签名称</p><p><br/></p><p>b.attrs：属性列表</p><p><br/></p><p>3）handler_data：处理标签里的数据体  </p><p><br/></p><p>Data：数据文本</p><p><br/></p><p>爬取数据并解析</p><p><br/></p><p><strong>示例：</strong></p><p><strong><br/></strong></p><p># -*- coding: utf-8 -*-</p><p>import urllib2</p><p>from HTMLParser import HTMLParser  </p><p><br/></p><p>class MovieParser(HTMLParser):  //定义电影解析器</p><p>def __init__(self):</p><p>        HTMLParser.__init__(self)  //调用父类的构造函数</p><p>        self.movies = []  //定义一个数组来解析保存出来的电影，默认为空</p><p><br/></p><p>    def handle_starttag(self, tag, attrs):  //重载这个handle_starttag方法，这个方法就可以去解析li这个数据</p><p>        def _attr(attrlist, attrname):  //定义一个函数来解析这个属性</p><p>            for attr in attrlist:  //从属性列表里面去取出对应列表的值</p><p>                if attr[0] == attrname:  //如果这个传进来的属性名称和这个要求要的名称一样</p><p>                    return attr[1]  //一样返回属性的值</p><p>            return None  //如果没有找到这个名称则返回空</p><p><br/></p><p>if tag == 'li' and _attr(attrs, 'data-title') </p><p>            movie = {}</p><p>            movie['title'] = _attr(attrs, 'data-title')   //电影名称</p><p>            movie['score'] = _attr(attrs, 'data-score')  //电影分数</p><p>            movie['director'] = _attr(attrs, 'data-director')  //电影导演</p><p>            movie['actors'] = _attr(attrs, 'data-actors')   //电影演员</p><p>            self.movies.append(movie)  //t提取出来后放到列表里面</p><p>            print('%(title)s|%(score)s|%(director)s|%(actors)s' % movie)</p><p><br/></p><p>def nowplaying_movies(url):</p><p>headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.73 Safari/537.36'}   //模拟一个浏览器的行为</p><p>    req = urllib2.Request(url, headers=headers)  //定制一个http头</p><p>s = urllib2.urlopen(req)  //获取这个请求</p><p>    parser = MovieParser()  //解析器</p><p>parser.feed(s.read())</p><p>s.close()</p><p>eturn parser.movies  //把解析器里面的movies返回给调用者</p><p><br/></p><p>if __name__ == '__main__':</p><p>    url = 'http://movie.douban.com/nowplaying/xiamen/' //豆瓣热播电影的地址，还有分城市</p><p>    movies = nowplaying_movies(url)  //定义一个函数nowplaying_movies，就是当前正在热播的电影，我们希望这个函数传进去就是url，还会就是一个电影列表</p><p><br/></p><p>    import json</p><p>print('%s' % json.dumps(movies, sort_keys=True, indent=4, separators=(',', ': ')))  //这个电影列表通过 json把它编码一下，打印出来</p><p><br/></p><p>运行结果，发现没有数据</p><p><br/></p><p><img alt="example7.png" src="images/9c9e796c6c65a41d09eeea741b8c3fd4.png" title="xPv3Fjg23hY4Ryx4rJ.png"/></p><p><br/></p><p>我们调试一下，发现代码有误，修改代码</p><p><br/></p><p># -*- coding: utf-8 -*-</p><p>import urllib2</p><p>from HTMLParser import HTMLParser  </p><p><br/></p><p>class MovieParser(HTMLParser):  //定义电影解析器</p><p>def __init__(self):</p><p>        HTMLParser.__init__(self)  //调用父类的构造函数</p><p>        self.movies = []  //定义一个数组来解析保存出来的电影，默认为空</p><p><br/></p><p>    def handle_starttag(self, tag, attrs):  //重载这个handle_starttag方法，这个方法就可以去解析li这个数据</p><p>        def _attr(attrlist, attrname):  //定义一个函数来解析这个属性</p><p>            for attr in attrlist:  //从属性列表里面去取出对应列表的值</p><p>                if attr[0] == attrname:  //如果这个传进来的属性名称和这个要求要的名称一样</p><p>                    return attr[1]  //一样返回属性的值</p><p>            return None  //如果没有找到这个名称则返回空</p><p><br/></p><p>if tag == 'li' and _attr(attrs, 'data-title') </p><p>            movie = {}</p><p>            movie['title'] = _attr(attrs, 'data-title')   //电影名称</p><p>            movie['score'] = _attr(attrs, 'data-score')  //电影分数</p><p>            movie['director'] = _attr(attrs, 'data-director')  //电影导演</p><p>            movie['actors'] = _attr(attrs, 'data-actors')   //电影演员</p><p>            self.movies.append(movie)  //t提取出来后放到列表里面</p><p>            print('%(title)s|%(score)s|%(director)s|%(actors)s' % movie)</p><p><br/></p><p>def nowplaying_movies(url):</p><p>headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.73 Safari/537.36'}   //模拟一个浏览器的行为</p><p>    req = urllib2.Request(url, headers=headers)  //定制一个http头</p><p>s = urllib2.urlopen(req)  //获取这个请求</p><p>    parser = MovieParser()  //解析器</p><p>parser.feed(s.read())</p><p>s.close()</p><p>eturn parser.movies  //把解析器里面的movies返回给调用者</p><p><br/></p><p>if __name__ == '__main__':</p><p>    url = 'http://movie.douban.com/nowplaying/xiamen/' //豆瓣热播电影的地址，还有分城市</p><p>    movies = nowplaying_movies(url)  //定义一个函数nowplaying_movies，就是当前正在热播的电影，我们希望这个函数传进去就是url，还会就是一个电影列表</p><p><br/></p><p>    import json</p><p>print('%s' % json.dumps(movies, sort_keys=True, indent=4, separators=(',', ': ')))  //这个电影列表通过 json把它编码一下，打印出来</p><p><br/></p><p>再运行一下，发现解析出了数据，但是我们发现数据解析出来的太多了</p><p><br/></p><p><img alt="example8.png" src="images/719b533aa34644829651ac6db050e46f.png" title="aZ6QyX0YMzA2L0VnGl.png"/></p><p><br/></p><p>返回网页发现我们的热播电影只有9个，但是我们把即将上映的电影一起解析出来了。</p><p><br/></p><p><img alt="example9.png" src="images/b049e7d97cd524e6ca3aac12cd4e70cf.png" title="juYwLCV1cewabNWuOx.png"/></p><p><br/></p><p>这个时候，我们需要找出一个数据特征，来区分出这两个电影，我们现在来看一下这个正在热播的电影的数据。</p><p><br/></p><p><img alt="example10.png" src="images/759c024d5312fc375247c79626e70bf0.png" title="7OEh9G8GHxLyMd2p9C.png"/></p><p><br/></p><p>我们再来看一下，即将上映的电影的数据有哪些不同的特征。我们发现，正在上映里面的data-category是nowplaying，这里data-category是upcoming，我们就可以利用这个来进行区别。</p><p><br/></p><p><img alt="example11.png" src="images/be9d0931335f5945af6497b63332b003.png" title="z8NkMWopZFu8Z51TJC.png"/></p><p><br/></p><p>代码如下</p><p><br/></p><p># -*- coding: utf-8 -*-</p><p>import urllib2</p><p>from HTMLParser import HTMLParser  </p><p><br/></p><p>class MovieParser(HTMLParser):  //定义电影解析器</p><p>def __init__(self):</p><p>        HTMLParser.__init__(self)  //调用父类的构造函数</p><p>        self.movies = []  //定义一个数组来解析保存出来的电影，默认为空</p><p><br/></p><p>    def handle_starttag(self, tag, attrs):  //重载这个handle_starttag方法，这个方法就可以去解析li这个数据</p><p>        def _attr(attrlist, attrname):  //定义一个函数来解析这个属性</p><p>            for attr in attrlist:  //从属性列表里面去取出对应列表的值</p><p>                if attr[0] == attrname:  //如果这个传进来的属性名称和这个要求要的名称一样</p><p>                    return attr[1]  //一样返回属性的值</p><p>            return None  //如果没有找到这个名称则返回空</p><p><br/></p><p>if tag == 'li' and _attr(attrs, 'data-title') and _attr(attrs, 'data-category') == 'nowplaying':</p><p>            movie = {}</p><p>            movie['title'] = _attr(attrs, 'data-title')   //电影名称</p><p>            movie['score'] = _attr(attrs, 'data-score')  //电影分数</p><p>            movie['director'] = _attr(attrs, 'data-director')  //电影导演</p><p>            movie['actors'] = _attr(attrs, 'data-actors')   //电影演员</p><p>            self.movies.append(movie)  //t提取出来后放到列表里面</p><p>            print('%(title)s|%(score)s|%(director)s|%(actors)s' % movie)</p><p><br/></p><p>def nowplaying_movies(url):</p><p>headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.73 Safari/537.36'}   //模拟一个浏览器的行为</p><p>    req = urllib2.Request(url, headers=headers)  //定制一个http头</p><p>s = urllib2.urlopen(req)  //获取这个请求</p><p>    parser = MovieParser()  //解析器</p><p>parser.feed(s.read())</p><p>s.close()</p><p>eturn parser.movies  //把解析器里面的movies返回给调用者</p><p><br/></p><p>if __name__ == '__main__':</p><p>    url = 'http://movie.douban.com/nowplaying/xiamen/' //豆瓣热播电影的地址，还有分城市</p><p>    movies = nowplaying_movies(url)  //定义一个函数nowplaying_movies，就是当前正在热播的电影，我们希望这个函数传进去就是url，还会就是一个电影列表</p><p><br/></p><p>    import json</p><p>print('%s' % json.dumps(movies, sort_keys=True, indent=4, separators=(',', ': ')))  //这个电影列表通过 json把它编码一下，打印出来</p><p><br/></p><p>运行结果，我们发现个数是对的上的。</p><p><br/></p><p><img alt="example12.png" src="images/a21d8d553666e1462eafd2e51bee3590.png" title="ZbgZzPdi6zRFwFWLgo.png"/></p><p><br/></p><p>后面这些数据是数组转换成json数据的打印。</p><p><br/></p><p><img alt="example13.png" src="images/dbd8f7c7e19f1e50b0e497822d2cefd6.png" title="HdBiyUhRyNwvcA97ud.png"/></p><p><br/></p><hr/><p><strong>作业</strong></p><p><strong><br/></strong></p><p>从豆瓣电影抓取即将上映的电影</p><p><br/></p><p>抓取的信息要求：</p><p><br/></p><p>1）电影名称</p><p><br/></p><p>2）电影时长</p><p><br/></p><p>3）上映时间</p><p><br/></p><p>4）导演</p><p><br/></p><p>5）演员信息</p><p><br/></p><p><br/></p><p><strong><span style="color: rgb(192, 0, 0);">【本文由麦子学院独家原创，转载请注明出处并保留原文链接】</span></strong></p><p><br/></p><p>
</p></p></div>
        </body></html>