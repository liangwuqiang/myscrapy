<!DOCTYPE html>
        <html><head><meta charset="UTF-8">
        </head><body>
        <p><center><h1>python爬虫之http协议</h1></center></p>
            <div class="cont">
<h1>python爬虫之http协议</h1>
<p><p><br/></p><hr/><p>http协议是互联网里面最重要，最基础的协议之一，我们的爬虫需要经常和http协议打交道。</p><p><br/></p><p>http报文展示：</p><p><br/></p><p>http报文</p><p><br/></p><p>打开开发者工具，查看http的包</p><p><br/></p><p><img alt="protocol1.png" src="images/63afe4fa2d09664c7665e44452ccb940.png" title="V5OnBLl4FXFxdHZrIi.png"/></p><p><br/></p><p>抓包查看</p><p><br/></p><p><img alt="protocol2.png" src="images/2e9625a8067aeeb9a619bcfb149a6dd9.png" title="u7Ptw7bqkkM8P1H8fv.png"/></p><p><br/></p><p>完整的http请求</p><p><br/></p><p><img alt="protocol3.png" src="images/209db255733aaeec323f95710b14ec74.png" title="LprnuX5W4jKnhAqqDH.png"/></p><p><br/></p><hr/><h3><span style="color: rgb(94, 207, 186);">http请求及构成</span></h3><p><br/></p><p><strong>http请求报文介绍</strong></p><p><strong><br/></strong></p><p>1）方法：GET/POST </p><p><br/></p><p>GET获取远程服务器；/  远程服务器的相对路径，这里是根目录，接下来跟的是一个http的协议号</p><p><br/></p><p>2）URl：相对路径</p><p><br/></p><p>3）Host：目标主机</p><p><br/></p><p>远程服务器的主机地址</p><p><br/></p><p>4）Accept：可接受的媒体类型</p><p><br/></p><p>客户端希望的连接处理方式；connection：希望连接继续保持，不要去关闭它</p><p><br/></p><p>5）User-Agent：浏览器身份</p><p><br/></p><p>6）Accept-Encoding：编码类型</p><p><br/></p><p>gzip：表示我可以接受这种压缩的媒体，压缩的媒体就可以减少这个带宽的占用，可以提高传输的速度。</p><p><br/></p><p>7）Accept-Language：接受的语言</p><p><br/></p><p>Zh-CN：中文，有些网站做的比较好的时候，你用中文的操作系统去访问它会显示中文，你用英文的操作系统去访问它会自动的显示英文，在早期的网站是需要用东西点，后来就越来越好，它会自动去识别，实际上就是使用这个字段来判别你到底使用的是什么字段。</p><p><br/></p><p>这个就是http的完整请求，这个就是客户端发送给服务器的，收到这个请求后，它会给我们一个应答，应答内容如下。</p><p><br/></p><p><img alt="protocol4.png" src="images/644dc130a84f6a35a7f5a9b07c69e82e.png" title="d6vRaSmw5dOr8a4iop.png"/></p><p><br/></p><p>这个应答里面第一个是http的协议号，第二个部分包含的是http的应答码，这个应答码是200的时候是正确的，第三个部分表示这个应答的信息。第二行表示这个应答的服务器是谁。</p><p><br/></p><hr/><h3><span style="color: rgb(94, 207, 186);">http应答及其构成</span></h3><p><br/></p><p><strong>http应答报文介绍</strong></p><p><br/></p><p><strong>1.应答码</strong></p><p><br/></p><p>2xx：成功<br/></p><p><br/></p><p>1)200：ok</p><p><br/></p><p>2)206:Partial Content</p><p><br/></p><p>3xx：重定向（客户端想要获取的资源，服务器告诉你，现在不在这了，你要到另外的地方去取，301和303都表示要到另外的地方去取，会给你提供新的URL）</p><p><br/></p><p>1)301：Moved Permanently</p><p><br/></p><p>2)303:See Other</p><p><br/></p><p>3)304：Not Modifide（没有修改）</p><p><br/></p><p>4xx：客户端错误（服务端会认为你客户端发的请求不对，比方说请求的格式不对，或者参数不对之类的）</p><p><br/></p><p>1）400：Not Found（你要请求的资源，在服务器上不存在）</p><p><br/></p><p>5xx：服务端错误</p><p><br/></p><p>1）500：Internal Server Error（比如某个网站被人攻击了，没有办法访问，就会出现这样的错误）</p><p><br/></p><p>2)501：Not Implemented</p><p><br/></p><p><strong>2.Server:应答服务器</strong></p><p><br/></p><p><strong>3.Content-Type:应答的数据类型</strong> （在客户端，我们就是根据这样的字段，来判断这个媒体到底是什么类型，然后做相应的不同处理）</p><p><br/></p><p>1）text/*</p><p><br/></p><p>2）image/*</p><p><br/></p><p>3）audio/*</p><p><br/></p><p>4）Video/*</p><p><br/></p><p>5）/</p><p><br/></p><p>示例：</p><p><br/></p><p>在应答里面，Content-Type的text是html类型，charset是utf-8。</p><p><br/></p><p><img alt="protocol5.png" src="images/3b4f9f4ab216919275bd1b5296c80eb9.png" title="I77UZxGTi5eyT37KeT.png"/></p><p><br/></p><p>我们来看一下应答，我们的应答就是一个html的文档，charset是utf-8的，这个就是一个标准的网页了。</p><p><br/></p><p><img alt="protocol6.png" src="images/b2a39b99fd8db026c1cb9c9d46de3471.png" title="oMcVJf3T2OklcGCBLm.png"/></p><p><br/></p><p>再看看Accept-Encoding，为了优化这种网络传输，它就发了这种gzip的内容过来</p><p><br/></p><p><img alt="protocol7.png" src="images/d2a2882ed41b9f6f5d7b16076ef2a457.png" title="g0Co9yzBM4OcZ9tyxi.png"/></p><p><br/></p><p><img alt="protocol8.png" src="images/c7c3dba56a0654483cf3453d673b599e.png" title="4SYFcd19b26CNPIoFy.png"/></p><p><br/></p><p>那我怎么看它到底是不是压缩了呢？应答的主体部分只有4315个字节，我们来看看它到底有多少个字节。</p><p><br/></p><p><img alt="protocol9.png" src="images/bc8538aebd8f933e7064cd07197c250c.png" title="1bJuM2EHLyqOsYFQDJ.png"/></p><p><br/></p><p>全选后我们可以看到，总共是312行，17826个字节，为什么会有这个差异呢？是因为我这边17k的内容是经过了gzip的压缩以后只剩下了4k左右，所以这样可以大大的减少这个网络传输的数据量，加快上网的速度。</p><p><br/></p><p><img alt="protocol10.png" src="images/014367ce4cbc64bf4c53043d70523cbe.png" title="d4TgGKaIHSIrenyYcq.png"/></p><p><br/></p><p><strong>4.Last-Modified：上一次修改时间</strong></p><p><br/></p><p><strong>5.Content-Encoding：应答编码类型</strong></p><p><br/></p><p>这里使用的是gzip，因为请求的时候只支持gzip，所以它应该是gzip压缩，这样的好处就是可以减少网络数据传输。</p><p><br/></p><p><strong>6.Content-Length：应答的内容长度</strong>，这里可以看到是4315个字节。</p><p><br/></p><p>这样一个完整的请求就是我们的一个http协议，我们发送一个请求过去，然后一个应答回来。这里的应答有一个很重要的就是应答码，这个我们以后在编程的时候会经常和它打交道。</p><p><br/></p><p><strong>更多请求和应答：</strong></p><p><strong><br/></strong></p><p><strong>1.下载css的请求</strong></p><p><br/></p><p>1)If-Modified-Since</p><p><br/></p><p>2)304 Not-Modified</p><p><br/></p><p><strong>2.下载图片的请求</strong></p><p><br/></p><p>1）Content-Type：image/*</p><p><br/></p><p>我们可以看到，这个页面不止一次发送了http请求，这个是第一个请求，它的编码类型也是gzip，也就是说，它已经经过压缩了。</p><p><br/></p><p><img alt="protocol11.png" src="images/690e0c86f2ddfda9e3528b1470a3131b.png" title="ILV9uFYgbRpmmn9RxK.png"/></p><p><br/></p><p>我们再看另一个，jquery，它的Content-Type明确的告诉这个客户端，它是JavaScript的脚本，那我们的浏览器遇到这样的媒体类型的时候，它就会去加载jquery的引擎去执行它。</p><p><br/></p><p><img alt="protocol12.png" src="images/ea98ddf38a2ba2e5dc50ae5be6c3752a.png" title="oXYJqCDAsoT019UEVV.png"/></p><p><br/></p><p>我们再看一个图片，这边这个url请求的地址就不一样，它现在已经不是在根目录下了，和第一个分析的不一样，另外它的Host也不一样，它的应答内容时iamge/gif，告诉我们客户端这是个图片。</p><p><br/></p><p><img alt="protocol13.png" src="images/fb8ae2b893a5c2609819f69b222b7400.png" title="3ijocoHC9nMoSHgSuq.png"/></p><p><br/></p><p>我们来看看这个图片到底长什么样</p><p><br/></p><p><img alt="protocol14.png" src="images/895d2bf786e86d4b9c6cade242d96893.png" title="6I38EA9HOtEHfkf2Fu.png"/></p><p><br/></p><p>那么一个完整的http应答到底长什么样，一个是应答的头部，如下。</p><p><br/></p><p><img alt="protocol15.png" src="images/a69e60ed4f358aa7056bbfc70acb071c.png" title="WQOcJDdVCkM8ojSPxe.png"/></p><p><br/></p><p>接下来，两个连续的回车，如果没有经过压缩，完整的就是如下，当然，我们刚刚的应答是经过压缩的，所以它后面的这部分就是应答的body，body这部分跟的就是压缩后的二进制数据。</p><p><br/></p><p><img alt="protocol16.png" src="images/9f144d53886133dfffc31ee11d1a5e19.png" title="ERab5hjibjnL8fnyLd.png"/></p><p><br/></p><p><br/></p><p><br/></p><p><strong><span style="color: rgb(192, 0, 0);">【本文由麦子学院独家原创，转载请注明出处并保留原文链接】</span></strong></p><p><br/></p><p>
</p></p></div>
        </body></html>