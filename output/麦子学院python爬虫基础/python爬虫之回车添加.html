<!DOCTYPE html>
        <html><head><meta charset="UTF-8">
        </head><body>
        <p><center><h1>python爬虫之回车添加</h1></center></p>
            <div class="cont">
<h1>python爬虫之回车添加</h1>
<p><p><br/></p><hr/><h3><span style="color: rgb(94, 207, 186);">添加回车</span></h3><p><br/></p><p>我们还可以有另外的需求，我们可以在每一句的后面加个回车，这样排版更好看一点，我们该怎么做呢？</p><p><br/></p><p># -*- coding: utf-8 -*-</p><p>import requests</p><p>import re</p><p>from HTMLParser import HTMLParser</p><p><br/></p><p># ugly code to fix UnicodeDecodeError</p><p>import sys</p><p>reload(sys)</p><p>sys.setdefaultencoding('utf8')</p><p><br/></p><p><br/></p><p>def _attr(attrs, attrname):</p><p>    for attr in attrs:</p><p>        if attr[0] == attrname:</p><p>            return attr[1]</p><p>    return None</p><p><br/></p><p><br/></p><p>class PoemParser(HTMLParser):</p><p>    def __init__(self):</p><p>        HTMLParser.__init__(self)</p><p>        self.in_div = False</p><p>        self.in_a = False</p><p>        self.pattern = re.compile(r'(.*)\((.*)\)')</p><p>        self.tangshi_list = []</p><p>        self.current_poem = {}</p><p><br/></p><p>    def handle_starttag(self, tag, attrs):</p><p>        if tag == 'div' and _attr(attrs, 'class') == 'guwencont2':</p><p>            self.in_div = True</p><p><br/></p><p>        if tag == 'a' and self.in_div:</p><p>            self.in_a = True</p><p>            self.current_poem['url'] = _attr(attrs, 'href')</p><p><br/></p><p>    def handle_endtag(self, tag):</p><p>        if tag == 'div':</p><p>            self.in_div = False</p><p><br/></p><p>        if tag == 'a':</p><p>            self.in_a = False</p><p><br/></p><p>    def handle_data(self, data):</p><p>        if self.in_a:</p><p>            m = self.pattern.match(data)</p><p>            if m:</p><p>                self.current_poem['title'] = m.group(1)</p><p>                self.current_poem['author'] = m.group(2)</p><p>                self.tangshi_list.append(self.current_poem)</p><p>                self.current_poem = {}</p><p><br/></p><p>class PoemContentParser(HTMLParser):</p><p>    def __init__(self):</p><p>        HTMLParser.__init__(self)</p><p>        self.content = []   //把它变成一个列表</p><p>        self.in_p = False   //定义一个标志位</p><p><br/></p><p>    def handle_starttag(self, tag, attrs): </p><p>        if tag == 'p' and _attr(attrs, 'align') == 'center':   //标签等于p，而且align的属性等于center</p><p>            self.in_p = True   //这样的标签我们认为是一个合法的标签</p><p><br/></p><p>    def handle_endtag(self, tag):   //退出了p这个字段以后，我们就认为不再这个数据范围里面</p><p>        if tag == 'p':   //标志位</p><p>            self.in_p = False</p><p><br/></p><p>    def handle_data(self, data):   //处理数据</p><p>        if self.in_p:   //只要在我们的合法标签内，我们就认为是我们想要的数据</p><p>             self.content.append(data)</p><p><br/></p><p>def retrive_tangshi_300():</p><p>    url = 'http://www.gushiwen.org/gushi/tangshi.aspx'</p><p>    r = requests.get(url)</p><p>    parser = PoemParser()</p><p>    parser.feed(r.content)</p><p>    return parser.tangshi_list</p><p><br/></p><p>def download_poem(poem):</p><p>    r = requests.get('http://www.gushiwen.org' + poem['url'])</p><p>    parser = PoemContentParser()</p><p>    parser.feed(r.content)</p><p>poem['content'] = '\n'.join(parser.content)   //把这个值放在字典里面</p><p><br/></p><p>def trim_ws(s):   //把所有的回车换行符都给它删掉</p><p>s = re.sub(r'\s+', '', s)  //空白符都给它删掉</p><p>s = s.replace(‘，’,’，\n’)  //把中文的逗号替换成中文的逗号加回车</p><p>s = s.replace(‘。’,’。\n’)  //把中文的句号替换成中文的句号加回车</p><p>return s</p><p><br/></p><p>def trim_href(s):</p><p>    return trim_ws(s)</p><p><br/></p><p><br/></p><p>def trim_test():</p><p>    s = """月落乌啼霜满天，江枫渔火对愁眠。</p><p>           姑苏城外</p><p>           寒山</p><p>           寺，夜半钟声到客船。"""</p><p>    print(trim_ws(s))</p><p><br/></p><p>    s = """</p><p>        凉风起天末，君子意如何。&lt;br&gt;</p><p>        鸿雁几时到，江湖秋水多。&lt;br&gt;</p><p>        文章憎命达，魑魅喜人过。&lt;br&gt;</p><p>        应共冤魂语，投&lt;a href="http://www.gushiwen.org/GuShiWen_148389ab4e.aspx"&gt;&lt;img style="vertical-align:middle;" src="http://www.gushiwen.org/favicon.ico" alt="诗" title="诗" width="14" height="14"&gt;&lt;/a&gt;</p><p>        赠汨罗。"""</p><p>    print(trim_href(s))</p><p><br/></p><p>if __name__ == '__main__':</p><p>trim_test()</p><p><br/></p><p>运行结果。</p><p><br/></p><p><img alt="grab17.png" src="images/4a2449dafd6be5767ec7a87777749e90.png" title="RQYi9AMjLgmOQqrxAd.png"/></p><p><br/></p><hr/><p><strong>我们看看使用正则表达式怎么做</strong></p><p><strong><br/></strong></p><p># -*- coding: utf-8 -*-</p><p>import requests</p><p>import re</p><p>from HTMLParser import HTMLParser</p><p><br/></p><p># ugly code to fix UnicodeDecodeError</p><p>import sys</p><p>reload(sys)</p><p>sys.setdefaultencoding('utf8')</p><p><br/></p><p><br/></p><p>def _attr(attrs, attrname):</p><p>    for attr in attrs:</p><p>        if attr[0] == attrname:</p><p>            return attr[1]</p><p>    return None</p><p><br/></p><p><br/></p><p>class PoemParser(HTMLParser):</p><p>    def __init__(self):</p><p>        HTMLParser.__init__(self)</p><p>        self.in_div = False</p><p>        self.in_a = False</p><p>        self.pattern = re.compile(r'(.*)\((.*)\)')</p><p>        self.tangshi_list = []</p><p>        self.current_poem = {}</p><p><br/></p><p>    def handle_starttag(self, tag, attrs):</p><p>        if tag == 'div' and _attr(attrs, 'class') == 'guwencont2':</p><p>            self.in_div = True</p><p><br/></p><p>        if tag == 'a' and self.in_div:</p><p>            self.in_a = True</p><p>            self.current_poem['url'] = _attr(attrs, 'href')</p><p><br/></p><p>    def handle_endtag(self, tag):</p><p>        if tag == 'div':</p><p>            self.in_div = False</p><p><br/></p><p>        if tag == 'a':</p><p>            self.in_a = False</p><p><br/></p><p>    def handle_data(self, data):</p><p>        if self.in_a:</p><p>            m = self.pattern.match(data)</p><p>            if m:</p><p>                self.current_poem['title'] = m.group(1)</p><p>                self.current_poem['author'] = m.group(2)</p><p>                self.tangshi_list.append(self.current_poem)</p><p>                self.current_poem = {}</p><p><br/></p><p>class PoemContentParser(HTMLParser):</p><p>    def __init__(self):</p><p>        HTMLParser.__init__(self)</p><p>        self.content = []   //把它变成一个列表</p><p>        self.in_p = False   //定义一个标志位</p><p><br/></p><p>    def handle_starttag(self, tag, attrs): </p><p>        if tag == 'p' and _attr(attrs, 'align') == 'center':   //标签等于p，而且align的属性等于center</p><p>            self.in_p = True   //这样的标签我们认为是一个合法的标签</p><p><br/></p><p>    def handle_endtag(self, tag):   //退出了p这个字段以后，我们就认为不再这个数据范围里面</p><p>        if tag == 'p':   //标志位</p><p>            self.in_p = False</p><p><br/></p><p>    def handle_data(self, data):   //处理数据</p><p>        if self.in_p:   //只要在我们的合法标签内，我们就认为是我们想要的数据</p><p>             self.content.append(data)</p><p><br/></p><p>def retrive_tangshi_300():</p><p>    url = 'http://www.gushiwen.org/gushi/tangshi.aspx'</p><p>    r = requests.get(url)</p><p>    parser = PoemParser()</p><p>    parser.feed(r.content)</p><p>    return parser.tangshi_list</p><p><br/></p><p>def download_poem(poem):</p><p>    r = requests.get('http://www.gushiwen.org' + poem['url'])</p><p>    parser = PoemContentParser()</p><p>    parser.feed(r.content)</p><p>poem['content'] = '\n'.join(parser.content)   //把这个值放在字典里面</p><p><br/></p><p>def trim_ws(s):   //把所有的回车换行符都给它删掉</p><p>s = re.sub(r'\s+', '', s)  //空白符都给它删掉</p><p><br/></p><p> def _add_crlf(m):</p><p>        return m.group() + '\r\n'   //返回替换后的文字</p><p><br/></p><p>    c = re.sub(r'，|。', _add_crlf, s)  //把中文的逗号和句号替换成中文的逗号加回车</p><p>return c</p><p><br/></p><p>def trim_href(s):</p><p>    return trim_ws(s)</p><p><br/></p><p><br/></p><p>def trim_test():</p><p>    s = """月落乌啼霜满天，江枫渔火对愁眠。</p><p>           姑苏城外</p><p>           寒山</p><p>           寺，夜半钟声到客船。"""</p><p>    print(trim_ws(s))</p><p><br/></p><p>    s = """</p><p>        凉风起天末，君子意如何。&lt;br&gt;</p><p>        鸿雁几时到，江湖秋水多。&lt;br&gt;</p><p>        文章憎命达，魑魅喜人过。&lt;br&gt;</p><p>        应共冤魂语，投&lt;a href="http://www.gushiwen.org/GuShiWen_148389ab4e.aspx"&gt;&lt;img style="vertical-align:middle;" src="http://www.gushiwen.org/favicon.ico" alt="诗" title="诗" width="14" height="14"&gt;&lt;/a&gt;</p><p>        赠汨罗。"""</p><p>    print(trim_href(s))</p><p><br/></p><p>if __name__ == '__main__':</p><p>trim_test()</p><p><br/></p><p>运行结果，这样我们就使用简单的正则表达式实现了这个功能，但是在实践过程中，如果有简单的字符串函数可以用的话，推荐大家用字符串函数，因为它的效率会比较高。</p><p><br/></p><p><img alt="grab18.png" src="images/28a2646e3af7a8f3c6ec20545ca8bb5f.png" title="BNrkjdXQ0E9CnyTq2W.png"/></p><p><br/></p><p><br/></p><p><br/></p><p><span style="color: rgb(192, 0, 0);">【本文由麦子学院独家原创，转载请注明出处并保留原文链接】</span></p><p><br/></p><p>
</p></p></div>
        </body></html>