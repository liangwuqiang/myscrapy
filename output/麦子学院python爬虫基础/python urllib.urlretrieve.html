<!DOCTYPE html>
        <html><head><meta charset="UTF-8">
        </head><body>
        <p><center><h1>python urllib.urlretrieve</h1></center></p>
            <div class="cont">
<h1>python urllib.urlretrieve</h1>
<p><p><br/></p><hr/><h3><span style="color: rgb(94, 207, 186);">urllib.urlretrieve</span></h3><p><br/></p><p>urllib.urlretrieve:（它提供了一个更便捷的功能，就是直接把远程的文件，下载到本地）</p><p><br/></p><p>1）url：远程地址</p><p><br/></p><p>2）filename：要保存到本地的文件</p><p><br/></p><p>3）reporthook：下载状态报告</p><p><br/></p><p>4）data：POST的application/x-www-form-urlencoded格式的数据</p><p><br/></p><p>5）返回（filename，HTTPMassage）</p><p><br/></p><p>示例：</p><p># -*- coding: utf-8 -*-</p><p>import urllib</p><p><br/></p><p>def print_list(list):</p><p>    for i in list:</p><p>        print(i)</p><p><br/></p><p>def retrieve():</p><p>    urllib.urlretrieve('http://blog.kamidox.com', 'index.html')</p><p><br/></p><p>if __name__ == '__main__':</p><p>retrieve()</p><p><br/></p><p>运行结果</p><p><br/></p><p><img alt="urllib15.png" src="images/049e58b3be96e9da07fb19983c528ea9.png" title="AjQPHz4GqSQb5Dq5Wo.png"/></p><p><br/></p><p>可以看到，这里马上出现了一个html的文件，打开后如下</p><p><br/></p><p><img alt="urllib16.png" height="311" src="images/1bbcf406e007bf2c590cd807de4419eb.png" style="width: 906px; height: 311px;" title="G6c33ZXKcP1XrnZCjM.png" width="906"/></p><p><br/></p><p>我们来看一下这个http对象</p><p><br/></p><p># -*- coding: utf-8 -*-</p><p>import urllib</p><p><br/></p><p>def print_list(list):</p><p>    for i in list:</p><p>        print(i)</p><p><br/></p><p>def retrieve():</p><p>fname,msg = urllib.urlretrieve('http://blog.kamidox.com', 'index.html')</p><p>print(fname)</p><p>print_list(msg.items())</p><p>if __name__ == '__main__':</p><p>retrieve()</p><p><br/></p><p>运行结果</p><p><br/></p><p><img alt="urllib17.png" src="images/8247d757e8385ee5cc6a5b2ba273ce3f.png" title="CugtAtwYVXwG8Gsd4R.png"/></p><p><br/></p><p>reporthook：看怎么来监控这个当前下载的进度</p><p><br/></p><p>1）参数1：当前传输的块数</p><p><br/></p><p>2）参数2：块大小</p><p><br/></p><p>3）参数3：数据总大小</p><p><br/></p><p>4）需要注意：content-length不是必须的</p><p><br/></p><p>实际上参数1，参数2相乘就是当前下载多少个字节，和参数3一除就知道这个百分比</p><p><br/></p><p>示例：</p><p># -*- coding: utf-8 -*-</p><p>import urllib</p><p><br/></p><p>def print_list(list):</p><p>    for i in list:</p><p>        print(i)</p><p><br/></p><p>def progress(blk, blk_size, total_size):  //监控这个大小的</p><p>print('%d/%d - %.02f%%' % (blk * blk_size, total_size, (float)(blk * blk_size) * 100 / total_size))  //打印下载进度，第一个是当前的大小，第二个是总大小，第三个是百分比</p><p><br/></p><p>def retrieve():</p><p>fname,msg = urllib.urlretrieve('http://blog.kamidox.com','index.html',reporthook=progress)</p><p>//把这个参数传进来</p><p>print(fname)</p><p>print_list(msg.items())</p><p><br/></p><p>if __name__ == '__main__':</p><p>retrieve()</p><p><br/></p><p>运行结果，可以看到整个进度都打印出来了，这里面为什么会超过100%，很可能是这个total_size里面的字节数，也就是指定应答类body的大小，它实际上是不包含它http头的大小。</p><p><br/></p><p><img alt="urllib18.png" src="images/800ea1a70cd48d99f46be2e632ba3d8b.png" title="3eJugmyMVCZJXUP2H0.png"/></p><p><br/></p><p><br/></p><p><br/></p><p><strong><span style="color: rgb(192, 0, 0);">【本文由麦子学院独家原创，转载请注明出处并保留原文链接】</span></strong></p><p><br/></p><p>
</p></p></div>
        </body></html>