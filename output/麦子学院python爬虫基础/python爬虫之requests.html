<!DOCTYPE html>
        <html><head><meta charset="UTF-8">
        </head><body>
        <p><center><h1>python爬虫之requests</h1></center></p>
            <div class="cont">
<h1>python爬虫之requests</h1>
<p><p><br/></p><hr/><h3><span style="color: rgb(94, 207, 186);">requests基础知识</span></h3><p><br/></p><p>requests简介：对http协议实现的一个库</p><p><br/></p><p>Http for humans：具有标准的Python风格的一个库</p><p><br/></p><p>和urllib/urllib2的区别：</p><p><br/></p><p>1）requests不是标准库</p><p><br/></p><p>2）最后的http库，PythonIC风格</p><p><br/></p><hr/><h3><span style="color: rgb(94, 207, 186);">安装pip install requests</span></h3><p><span style="color: rgb(94, 207, 186);"><br/></span></p><p><strong>请求：</strong></p><p><br/></p><p><strong>1.requests.request发送一个http请求</strong></p><p><br/></p><p>1）method：get/post/head/put/delete   http的请求方法</p><p><br/></p><p>2）url请求的目标地址</p><p><br/></p><p>3）params:请求的参数，这个参数是一个字典</p><p><br/></p><p>4）data：字典，字节流，或类文件句柄  要上传的数据，可以支持很多种数据格式</p><p><br/></p><p>5）json：上传的json数据</p><p><br/></p><p>6）headsers：自定义http头</p><p><br/></p><p>7）cookies：发送额外的cookies，可以使用这个格式发送一个字典格式的cookies，但需要说明的是，这个request接口默认会处理这个cookies，也就是你第一次发送的请求，如果应答里面包含有cookie的话，这个时候你再发请求的话，它会自动把第一次应答的cookie再发回给服务器，所以，不需要向我们的urllib里面去处理它。</p><p><br/></p><p>8）verify：是否检验证书，在Python里面，标准的做法是需要向证书检验，检查它是不是可信的机构发的，这个verify默认是true的，那对于一些自签名的证书，比如说我们的博客，那这个证书是自己给自己签名的，不是标准的公认的CA签名的，那这个时候可能我就不去检验这个证书了。</p><p><br/></p><p><strong>2.requests.get</strong></p><p><br/></p><p>1）url</p><p><br/></p><p>2）和request的参数一样</p><p><br/></p><p><strong>3.requests.post</strong></p><p><br/></p><p>1）url</p><p><br/></p><p>2）data</p><p><br/></p><p>3）json</p><p><br/></p><p>4）和request的参数一样</p><p><br/></p><p><strong>4.requests.head</strong></p><p><strong><br/></strong></p><p><strong>5.requests.put</strong></p><p><strong><br/></strong></p><p><strong>6.Requests.delete</strong></p><p><strong><br/></strong></p><p>只在for REST API里面比较常见</p><p><br/></p><p><strong>应答：</strong></p><p><strong><br/></strong></p><p>requests.Response</p><p><br/></p><p>1）status_code状态码</p><p><br/></p><p>2）headers应答的http头</p><p><br/></p><p>3）json应答的json数据</p><p><br/></p><p>4）text应答的unicode编码的文本</p><p><br/></p><p>5）content应答的字节流数据</p><p><br/></p><p>6）cookies应答的cookies，自动处理</p><p><br/></p><p><strong>示例：</strong></p><p><br/></p><p># -*- coding: utf-8 -*-</p><p>import requests</p><p><br/></p><p>def get_json():</p><p>    r = requests.get('https://api.github.com/events')</p><p>    print(r.status_code)  //打印一个状态码</p><p>    print(r.json())  //直接把这个应答打印成json数据</p><p><br/></p><p>if __name__ == '__main__':</p><p>get_json()</p><p><br/></p><p>运行结果，我们可以看到这个应答码是200，它的json就直接转化成了以下的数据。</p><p><br/></p><p><img alt="requests1.png" src="images/aaff0783f30470328ca86dcf1abc2b34.png" title="Q5BnrEl8ixjwPrWAYu.png"/></p><p>打印出不同格式的内容，代码如下：</p><p><br/></p><p># -*- coding: utf-8 -*-</p><p>import requests</p><p><br/></p><p>def get_json():</p><p>    r = requests.get('https://api.github.com/events')</p><p>print(r.status_code)  //打印一个状态码</p><p>print(r.headers)  //打印头</p><p>print(r.content)  //打印出字节流</p><p>print(r.text)</p><p>    print(r.json())    //直接把这个应答打印成json数据</p><p><br/></p><p>if __name__ == '__main__':</p><p> get_json()</p><p><br/></p><p>运行结果，状态还是200。</p><p><br/></p><p><img alt="requests2.png" height="114" src="images/6a0408d3aaccf6020e8d80104301fbed.png" style="width: 1017px; height: 114px;" title="AAk3o8ZFPXTMeTt50w.png" width="1017"/></p><p><br/></p><p>怎么去定制这个http请求的参数，代码如下：</p><p><br/></p><p># -*- coding: utf-8 -*-</p><p>import requests</p><p><br/></p><p>def get_querystring():</p><p>    url = ‘http://httpbin.org/get’  //返回的url</p><p>    params = {'qs1': 'value1', 'qs2': 'value2'}  //返回的参数</p><p>    r = requests.get('url', params=params)  //发送请求，把我们的请求参数带进去</p><p>    print(r.status_code)  //打印状态码</p><p>    print(r.content)</p><p><br/></p><p>if __name__ == '__main__':</p><p>get_querystring()</p><p><br/></p><p>运行结果，应答码是200，args就是我们发送的参数，这个url就是我们真正请求的url。</p><p><br/></p><p><img alt="requests3.png" height="167" src="images/856a19bed7869c56396a64bba2440dfa.png" style="width: 990px; height: 167px;" title="fKm29nLOA5BDq8L9ix.png" width="990"/></p><p><br/></p><p>介绍一下，httpbin.org是一个专门用来测试http协议的一个网站。</p><p><br/></p><p><img alt="requests4.png" height="445" src="images/c6e021fca4f4a9a62528855dc7e23b7d.png" style="width: 889px; height: 445px;" title="MjhDBs2hiIQd30q7eJ.png" width="889"/></p><p><br/></p><p>Ip就表示它会打开我们电脑的这个ip地址</p><p><br/></p><p><img alt="requests5.png" src="images/ea56391da8abfafb3cec8187b592dbb0.png" title="4ALIQAJRNdpowkizwD.png"/></p><p><br/></p><p><br/></p><p>headers，我们的浏览器发送过去的http头</p><p><br/></p><p><img alt="requests6.png" height="150" src="images/9eade3442ae7d4b3631827f66a7adc30.png" style="width: 906px; height: 150px;" title="hYMAbqKt1kWd9GocDr.png" width="906"/></p><p><br/></p><p>user_agent就表示它会打印出我电脑发送过去的user_agent</p><p><br/></p><p><img alt="requests7.png" src="images/e6a52f44c90c53a5e3c0900e1bb0cf0b.png" title="tjKiEJjqxLetsTP0pC.png"/></p><p><br/></p><p>get，返回我们发送过去的请求，args是参数，heads是我们发过去的头，origin就是我们自己的电脑ip地址，url就是我发过去的url。</p><p><br/></p><p><img alt="requests8.png" src="images/2c875480aca8b925c72da4e592dd3969.png" title="k3tmKybhWDoQWGEpcC.png"/></p><p><br/></p><p>怎么定制http头，代码如下：</p><p><br/></p><p># -*- coding: utf-8 -*-</p><p>import requests</p><p><br/></p><p>def get_querystring():</p><p>    url = ‘http://httpbin.org/get’  //返回的url</p><p>    params = {'qs1': 'value1', 'qs2': 'value2'}  //返回的参数</p><p>r = requests.get('url', headers=headers)  //用headers参数来定制http头</p><p>    print(r.status_code)  //打印状态码</p><p>    print(r.content)</p><p><br/></p><p>if __name__ == '__main__':</p><p>get_querystring()</p><p><br/></p><p>运行结果，应答码还是200，这个请求里面我们没有带参数，所以，这里面的参数都是空的，这个头就是我们发过去的头</p><p><br/></p><p><img alt="requests9.png" height="157" src="images/65a58d73016111f83cedfd2fc949c9ad.png" style="width: 1016px; height: 157px;" title="QWzUnVKHZiwWqukmWy.png" width="1016"/></p><p><br/></p><p>怎么处理cookies，代码如下：</p><p><br/></p><p># -*- coding: utf-8 -*-</p><p>import requests</p><p><br/></p><p>ddef get_cookie():</p><p>    headers = {'User-Agent': 'Chrome'}</p><p>    url = 'http://www.douban.com'</p><p>    r = requests.get(url, headers=headers)</p><p>    print(r.status_code)</p><p>    print(r.cookies)</p><p><br/></p><p>if __name__ == '__main__':</p><p>    get_cookie()</p><p><br/></p><p>运行结果，这里面包含了两个cookie</p><p><br/></p><p><img alt="requests10.png" height="89" src="images/e67d1cb47ddee32782effccca146069d.png" style="width: 985px; height: 89px;" title="QbB9wurjWr7xkMqw0i.png" width="985"/></p><p><br/></p><p>修改代码，获取bid的参数</p><p><br/></p><p># -*- coding: utf-8 -*-</p><p>import requests</p><p><br/></p><p>ddef get_cookie():</p><p>    headers = {'User-Agent': 'Chrome'}</p><p>    url = 'http://www.douban.com'</p><p>    r = requests.get(url, headers=headers)</p><p>    print(r.status_code)</p><p>    print(r.cookies[‘bid’])</p><p><br/></p><p>if __name__ == '__main__':</p><p>    get_cookie()</p><p><br/></p><p>运行结果，这样就把bid的cookies打印出来了。</p><p><br/></p><p><img alt="requests11.png" height="79" src="images/0d299570fafe78959459c066700df0d9.png" style="width: 994px; height: 79px;" title="uHLtMeLr7e0emM5IpG.png" width="994"/></p><p><br/></p><hr/><h3><span style="color: rgb(94, 207, 186);">高级用法</span></h3><p><br/></p><p>1）Session：同一个会话内参数保持一致，且会重用TCP连接以提高性能，也会尽量保持连接以提高性能。</p><p><br/></p><p>2）SSL证书认证：开启，关闭，自定义CA证书</p><p><br/></p><p>3）上传普通文件和复杂结构的文件</p><p><br/></p><p>4）代理访问</p><p><br/></p><hr/><h3><span style="color: rgb(94, 207, 186);">作业</span></h3><p><br/></p><p>1、阅读requests库的官方文档</p><p><br/></p><p>1）了解基本用法</p><p><br/></p><p>2）了解高级用法</p><p><br/></p><p><img alt="requests12.png" src="images/f1cc1def845f64bbe6eb95194470289a.png" title="KWjjBmWpNh0d3niU5N.png"/></p><p></p><p><br/></p><p>2、爬虫实例：豆瓣热播电影</p><p><br/></p><p>1）用requests重新实现豆瓣热播电影</p><p><br/></p><p>2）增加功能：下载每个电影的海报图片</p><p><br/></p><p>热播电影数据格式</p><p><br/></p><p>使用Chrome的开发者工具查看豆瓣热播电影的数据格式</p><p><br/></p><p>使用requests重构代码</p><p><br/></p><p>增加图片下载功能</p><p><br/></p><p><br/></p><p>3、豆瓣音乐</p><p><br/></p><p>实现一个爬虫，获取新碟榜单曲</p><p><br/></p><p>要求：</p><p><br/></p><p>歌曲名称</p><p><br/></p><p>歌手名字</p><p><br/></p><p>豆瓣评分</p><p><br/></p><p>解析单曲封面图片url并把图片下载下来</p><p><br/></p><p><br/></p><p><br/></p><p><strong><span style="color: rgb(192, 0, 0);">【本文由麦子学院独家原创，转载请注明出处并保留原文链接】</span></strong></p><p><br/></p><p>
</p></p></div>
        </body></html>